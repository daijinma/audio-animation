{"version":3,"file":"bundle.js","sources":["../src/sirWave.js","../src/index.js"],"sourcesContent":["export default class SirWave {\n    constructor(opt){\n        this.opt = opt || {};\n\n        this.K = 2;\n        this.F = 2;\n        this.speed = this.opt.speed || 0.1;\n        this.noise = this.opt.noise || 0;\n        this.phase = this.opt.phase || 0;\n        this.lines = this.opt.lines || [\n\t\t\t[-2, 'rgba(74, 74, 74, 0.2)', 1],\n\t\t\t[-6, 'rgba(74, 74, 74, 0.4)', 1],\n\t\t\t[4, 'rgba(74, 74, 74, 0.5)', 1],\n\t\t\t[2, 'rgba(74, 74, 74, 0.6)', 1],\n\t\t\t[1, 'rgba(74, 74, 74, 0.5)', 2],\n\t\t];\n\n        if (!devicePixelRatio) devicePixelRatio = 1;\n        this.width = devicePixelRatio * (this.opt.width || 320);\n        this.height = devicePixelRatio * (this.opt.height || 100);\n        this.MAX = (this.height/2)-4;\n\n\t\tif(this.opt.ctx){\n\t\t\tthis.ctx = this.opt.ctx\n\t\t}else{\n\t\t\tthis.canvas = document.createElement('canvas');\n\t\t\tthis.canvas.width = this.width;\n\t\t\tthis.canvas.height = this.height;\n\t\t\tthis.canvas.style.width = (this.width/devicePixelRatio)+'px';\n\t\t\tthis.canvas.style.height = (this.height/devicePixelRatio)+'px';\n\t\t\t(this.opt.container || document.body).appendChild(this.canvas);\n\t\t\tthis.ctx = this.canvas.getContext('2d');\n\t\t}\n        this.run = false;\n    }\n\n    _globalAttenuationFn=(x)=>{\n\t\treturn Math.pow(this.K*4/(this.K*4+Math.pow(x,4)),this.K*2);\n\t}\n\n\t_drawLine=(attenuation, color, width)=>{\n\t\tthis.ctx.moveTo(0,0);\n\t\tthis.ctx.beginPath();\n\t\tthis.ctx.strokeStyle = color;\n\t\tthis.ctx.lineWidth = width || 1;\n\t\tvar x, y;\n\t\tfor (var i=-this.K; i<=this.K; i+=0.01) {\n\t\t\tx = this.width*((i+this.K)/(this.K*2));\n\t\t\ty = this.height/2 + this.noise * this._globalAttenuationFn(i) * (1/attenuation) * Math.sin(this.F*i-this.phase);\n\t\t\tthis.ctx.lineTo(x, y);\n\t\t}\n\t\tthis.ctx.stroke();\n\t}\n\n\tdrawOnePage(){\n\t\tthis.run = true;\n\t\tthis.phase = Math.random()*10;\n\t\tthis._draw()\n\t\trequestAnimationFrame(()=>{\n\t\t\tthis.run = false;\n\t\t});\n\t}\n\n\t_clear=()=>{\n\t\tthis.ctx.globalCompositeOperation = 'destination-out';\n\t\tthis.ctx.fillRect(0, 0, this.width, this.height);\n\t\tthis.ctx.globalCompositeOperation = 'source-over';\n\t}\n\n\t_draw=()=>{\n\t\tif (!this.run) return;\n\n\t\tthis.phase = (this.phase+this.speed)%(Math.PI*64);\n\t\tthis._clear();\n\n\t\tthis.lines.forEach((line)=>{\n\t\t\tthis._drawLine.apply(this, line)\n\t\t})\n\n\t\trequestAnimationFrame(this._draw.bind(this), 1000);\n\t}\n\n\tstart=()=>{\n\t\tthis.run = true;\n\t\tthis._draw();\n\t}\n\n\tstop=()=>{\n\t\tthis.run = false;\n\t\tthis._clear();\n\t}\n\n\tpause=()=>{\n\t\tthis.run = false;\n\t}\n\n\tsetNoise=(v)=>{\n\t\tthis.noise = Math.min(v, 1)*this.MAX;\n\t}\n\n\tsetSpeed=(v)=>{\n\t\tthis.speed = v;\n\t}\n\n\tset=(noise, speed)=>{\n\t\tthis.setNoise(noise);\n\t\tthis.setSpeed(speed);\n\t}\n}","/**\n * https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\n * https://www.jianshu.com/p/7c4f58ee8972\n *  */\n\n\n import SirWave from \"./sirWave\";\n\nexport default class auduoMap {\n    constructor(params){\n        if(!params.el){\n            throw Error(\"el is required!\")\n        }\n\n        Object.assign(this, params)\n        \n        this.initlize(this.url);\n\n        this.SW = new SirWave({\n            ctx: this.ctx,\n            width: this.width,\n            height: this.height,\n            lines:this.lines           \n        })\n        this.SW.setSpeed(0.2);\n        \n        this.SW.setNoise(0.2);\n        this.SW.drawOnePage();\n    }\n\n    play(){\n        if(this.audio.paused){\n            this.audio.play();\n            this.SW.start();\n        }else{\n            this.audio.pause();\n            this.SW.pause();\n        }\n    }\n    destroy(){\n        this.audio.pause();\n        this.SW.pause()\n    }\n\n    // 初始化场景\n    initlize(url){\n        let canvas = this.el;\n        this.ctx = this.ctx = canvas.getContext(\"2d\");\n\n        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n        let audio = this.audio = new Audio(url);\n        audio.crossOrigin = \"anonymous\";\n\n        this.audio.onended = ()=>{\n            this.SW.pause();\n        }\n\n    }\n}"],"names":["SirWave","opt","x","Math","pow","K","attenuation","color","width","ctx","moveTo","beginPath","strokeStyle","lineWidth","y","i","height","noise","_globalAttenuationFn","sin","F","phase","lineTo","stroke","globalCompositeOperation","fillRect","run","speed","PI","_clear","lines","forEach","line","_drawLine","apply","requestAnimationFrame","_draw","bind","v","min","MAX","setNoise","setSpeed","devicePixelRatio","canvas","document","createElement","style","container","body","appendChild","getContext","random","auduoMap","params","el","Error","Object","assign","initlize","url","SW","drawOnePage","audio","paused","play","start","pause","audioCtx","window","AudioContext","webkitAudioContext","Audio","crossOrigin","onended"],"mappings":"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"}