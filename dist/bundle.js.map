{"version":3,"file":"bundle.js","sources":["../src/sirWave.js","../src/index.js"],"sourcesContent":["export default class SirWave {\n    constructor(opt){\n        this.opt = opt || {};\n\t\tthis.dpr = window.devicePixelRatio || 1;\n        this.K = 2;\n        this.F = 2;\n        this.speed = this.opt.speed || 0.1;\n        this.noise = this.opt.noise || 0;\n        this.phase = this.opt.phase || 0;\n        this.lines = this.opt.lines || [\n\t\t\t[-2, 'rgba(74, 74, 74, 0.2)', 1],\n\t\t\t[-6, 'rgba(74, 74, 74, 0.4)', 1],\n\t\t\t[4, 'rgba(74, 74, 74, 0.5)', 1],\n\t\t\t[2, 'rgba(74, 74, 74, 0.6)', 1],\n\t\t\t[1, 'rgba(74, 74, 74, 0.5)', 2],\n\t\t];\n\n        this.width = this.dpr * (this.opt.width || 320);\n        this.height = this.dpr * (this.opt.height || 100);\n        this.MAX = (this.height/2)-4;\n\n\t\tif(this.opt.ctx){\n\t\t\tthis.ctx = this.opt.ctx\n\t\t}else{\n\t\t\tthis.canvas = document.createElement('canvas');\n\t\t\tthis.canvas.width = this.width;\n\t\t\tthis.canvas.height = this.height;\n\t\t\tthis.canvas.style.width = (this.width/this.dpr)+'px';\n\t\t\tthis.canvas.style.height = (this.height/this.dpr)+'px';\n\t\t\t(this.opt.container || document.body).appendChild(this.canvas);\n\t\t\tthis.ctx = this.canvas.getContext('2d');\n\t\t}\n        this.run = false;\n    }\n\n    _globalAttenuationFn(x){\n\t\treturn Math.pow(this.K*4/(this.K*4+Math.pow(x,4)),this.K*2);\n\t}\n\n\t_drawLine(attenuation, color, width){\n\t\tthis.ctx.moveTo(0,0);\n\t\tthis.ctx.beginPath();\n\t\tthis.ctx.strokeStyle = color;\n\t\tthis.ctx.lineWidth = width || 1;\n\t\tvar x, y;\n\t\tfor (var i=-this.K; i<=this.K; i+=0.01) {\n\t\t\tx = this.width*((i+this.K)/(this.K*2));\n\t\t\ty = this.height/2 + this.noise * this._globalAttenuationFn(i) * (1/attenuation) * Math.sin(this.F*i-this.phase);\n\t\t\tthis.ctx.lineTo(x, y);\n\t\t}\n\t\tthis.ctx.stroke();\n\t}\n\n\tdrawOnePage(){\n\t\tlet runing = this.run;\n\t\tthis.run = true;\n\t\tthis.phase = this.phase==0?Math.random()*10:this.phase;\n\t\tthis._draw()\n\t\trequestAnimationFrame(()=>{\n\t\t\tthis.run = runing;\n\t\t});\n\t}\n\n\t_clear(){\n\t\tthis.ctx.globalCompositeOperation = 'destination-out';\n\t\tthis.ctx.fillRect(0, 0, this.width, this.height);\n\t\tthis.ctx.globalCompositeOperation = 'source-over';\n\t}\n\n\t_draw(){\n\t\tif (!this.run) return;\n\n\t\tthis.phase = (this.phase+this.speed)%(Math.PI*64);\n\t\tthis._clear();\n\n\t\tthis.lines.forEach((line)=>{\n\t\t\tthis._drawLine.apply(this, line)\n\t\t})\n\n\t\trequestAnimationFrame(this._draw.bind(this), 1000);\n\t}\n\n\t\n\n\tstart(){\n\t\tthis.run = true;\n\t\tthis._draw();\n\t}\n\n\tstop(){\n\t\tthis.run = false;\n\t\tthis._clear();\n\t}\n\n\tpause(){\n\t\tthis.run = false;\n\t}\n\n\tsetNoise(v){\n\t\tthis.noise = Math.min(v, 1)*this.MAX;\n\t}\n\n\tsetSpeed(v){\n\t\tthis.speed = v;\n\t}\n\n\tset(noise, speed){\n\t\tthis.setNoise(noise);\n\t\tthis.setSpeed(speed);\n\t}\n}","/**\n * https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\n * https://www.jianshu.com/p/7c4f58ee8972\n *  */\n\n\n import SirWave from \"./sirWave\";\n\nexport default class auduoMap {\n    constructor(params){\n\n        Object.assign(this, params)\n        \n        this.initlize(this.url);\n\n        this.SW = new SirWave({\n            ...params       \n        })\n        this.SW.setSpeed(0.2);\n        \n        this.SW.setNoise(0.2);\n        this.SW.drawOnePage();\n    }\n\n    play(){\n        if(this.audio.paused){\n            this.audio.play();\n            this.SW.start();\n        }else{\n            this.audio.pause();\n            this.SW.pause();\n        }\n    }\n    destroy(){\n        this.audio.pause();\n        this.SW.pause()\n    }\n\n    // 初始化场景\n    initlize(url){\n        let audio = this.audio = new Audio(url);\n        audio.crossOrigin = \"anonymous\";\n\n        this.audio.onended = ()=>{\n            this.SW.pause();\n\n            this.onended && this.onended();\n        }\n\n    }\n\n    resize(width, height){\n        let phase= this.SW.phase\n        this.SW.width = width;\n        this.SW.height = height;\n\n        this.SW.canvas.setAttribute('width', width);\n        this.SW.canvas.setAttribute('height', height);\n\n        this.SW.canvas.style.width = (width)+\"px\";\n        this.SW.canvas.style.height = (height)+\"px\";\n        this.SW._clear();\n        if(!this.SW.run){\n            this.SW.drawOnePage();\n        }\n        this.SW.phase = phase;\n    }\n}"],"names":["SirWave","opt","dpr","window","devicePixelRatio","K","F","speed","noise","phase","lines","width","height","MAX","ctx","canvas","document","createElement","style","container","body","appendChild","getContext","run","x","Math","pow","attenuation","color","moveTo","beginPath","strokeStyle","lineWidth","y","i","_globalAttenuationFn","sin","lineTo","stroke","runing","random","_draw","requestAnimationFrame","globalCompositeOperation","fillRect","PI","_clear","forEach","line","_drawLine","apply","bind","v","min","setNoise","setSpeed","auduoMap","params","Object","assign","initlize","url","SW","drawOnePage","audio","paused","play","start","pause","Audio","crossOrigin","onended","setAttribute"],"mappings":"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"}