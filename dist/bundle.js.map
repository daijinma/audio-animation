{"version":3,"file":"bundle.js","sources":["../src/sirWave.js","../src/index.js"],"sourcesContent":["export default class SirWave {\n    constructor(opt){\n        this.opt = opt || {};\n\n        this.K = 2;\n        this.F = 2;\n        this.speed = this.opt.speed || 0.1;\n        this.noise = this.opt.noise || 0;\n        this.phase = this.opt.phase || 0;\n        this.lines = this.opt.lines || [\n\t\t\t[-2, 'rgba(255,255,255, 0.1)'],\n\t\t\t[-6, 'rgba(255,255,255,0.2)'],\n\t\t\t[4, 'rgba(255,255,255,0.4)'],\n\t\t\t[2, 'rgba(255,255,255,0.6)'],\n\t\t\t[1, 'rgba(255,255,255,1)', 1.5],\n\t\t];\n\n        if (!devicePixelRatio) devicePixelRatio = 1;\n        this.width = devicePixelRatio * (this.opt.width || 320);\n        this.height = devicePixelRatio * (this.opt.height || 100);\n        this.MAX = (this.height/2)-4;\n\n\t\tif(this.opt.ctx){\n\t\t\tthis.ctx = this.opt.ctx\n\t\t}else{\n\t\t\tthis.canvas = document.createElement('canvas');\n\t\t\tthis.canvas.width = this.width;\n\t\t\tthis.canvas.height = this.height;\n\t\t\tthis.canvas.style.width = (this.width/devicePixelRatio)+'px';\n\t\t\tthis.canvas.style.height = (this.height/devicePixelRatio)+'px';\n\t\t\t(this.opt.container || document.body).appendChild(this.canvas);\n\t\t\tthis.ctx = this.canvas.getContext('2d');\n\t\t}\n        this.run = false;\n    }\n\n    _globalAttenuationFn=(x)=>{\n\t\treturn Math.pow(this.K*4/(this.K*4+Math.pow(x,4)),this.K*2);\n\t}\n\n\t_drawLine=(attenuation, color, width)=>{\n\t\tthis.ctx.moveTo(0,0);\n\t\tthis.ctx.beginPath();\n\t\tthis.ctx.strokeStyle = color;\n\t\tthis.ctx.lineWidth = width || 1;\n\t\tvar x, y;\n\t\tfor (var i=-this.K; i<=this.K; i+=0.01) {\n\t\t\tx = this.width*((i+this.K)/(this.K*2));\n\t\t\ty = this.height/2 + this.noise * this._globalAttenuationFn(i) * (1/attenuation) * Math.sin(this.F*i-this.phase);\n\t\t\tthis.ctx.lineTo(x, y);\n\t\t}\n\t\tthis.ctx.stroke();\n\t}\n\n\t_clear=()=>{\n\t\tthis.ctx.globalCompositeOperation = 'destination-out';\n\t\tthis.ctx.fillRect(0, 0, this.width, this.height);\n\t\tthis.ctx.globalCompositeOperation = 'source-over';\n\t}\n\n\t_draw=()=>{\n\t\tif (!this.run) return;\n\n\t\tthis.phase = (this.phase+this.speed)%(Math.PI*64);\n\t\tthis._clear();\n\n\t\tthis.lines.forEach((line)=>{\n\t\t\tthis._drawLine.apply(this, line)\n\t\t})\n\n\t\trequestAnimationFrame(this._draw.bind(this), 1000);\n\t}\n\n\tstart=()=>{\n\t\tthis.phase = 0;\n\t\tthis.run = true;\n\t\tthis._draw();\n\t}\n\n\tstop=()=>{\n\t\tthis.run = false;\n\t\tthis._clear();\n\t}\n\n\tpause=()=>{\n\t\tthis.run = false;\n\t}\n\n\tsetNoise=(v)=>{\n\t\tthis.noise = Math.min(v, 1)*this.MAX;\n\t}\n\n\tsetSpeed=(v)=>{\n\t\tthis.speed = v;\n\t}\n\n\tset=(noise, speed)=>{\n\t\tthis.setNoise(noise);\n\t\tthis.setSpeed(speed);\n\t}\n}","/**\n * https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\n * https://www.jianshu.com/p/7c4f58ee8972\n *  */\n\n\n import SirWave from \"./sirWave\";\n\nexport default class auduoMap {\n    constructor(params){\n        if(!params.el){\n            throw Error(\"el is required!\")\n        }\n\n        Object.assign(this, params)\n        \n        this.initlize(this.url);\n\n        this.SW = new SirWave({\n            ctx: this.ctx,\n            width: this.width,\n            height: this.height,\n            lines:this.lines           \n        })\n        this.SW.setSpeed(0.2);\n        this.SW.start();\n        this.SW.setNoise(0.2);\n    }\n\n    play(){\n        if(this.audio.paused){\n            this.audio.play();\n        }else{\n            this.audio.pause();\n        }\n        \n    }\n    destroy(){\n        this.audio.pause();\n    }\n\n    // 初始化场景\n    initlize(url){\n        let canvas = this.el;\n        this.ctx = this.ctx = canvas.getContext(\"2d\");\n\n        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n        let audio = this.audio = new Audio(url);\n        audio.crossOrigin = \"anonymous\";\n\n        this.source = audioCtx.createMediaElementSource(audio);\n        this.analyser = audioCtx.createAnalyser();\n\n        //连接：source → analyser → destination\n        this.source.connect(this.analyser);\n        this.analyser.connect(audioCtx.destination);\n        this.bufferLength = 360;\n\n    }\n\n    playFun(){\n        \n    }\n\n    drawColumn(ctx, output){\n        ctx.clearRect(0, 0, this.width, this.height);\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n\n        let bufferLength = this.bufferLength;\n        var barWidth = (this.width / bufferLength) * 2.5;\n        var barHeight;\n        var x = 0;\n\n        for(var i = 0; i < bufferLength; i++) {\n            barHeight = output[i]/2;\n    \n            ctx.fillStyle = '#000';\n            ctx.fillRect(x,this.height-barHeight/2,barWidth,barHeight);\n\n            x += barWidth + 1;\n        }\n\n    }\n\n    drawCircle(ctx, output , r=100){\n        ctx.clearRect(0, 0, this.width, this.height);\n        //画线条\n        let centerX = this.width/2;\n        let centerY = this.height/2;\n\n        ctx.beginPath();\n        ctx.lineWidth = 2;\n\n        ctx.moveTo(centerX, centerY);\n\n        for (var i = 0; i <360 ; i++) {\n            var value = output[i];//<===获取数据\n            //R * cos (PI/180*一次旋转的角度数) ,-R * sin (PI/180*一次旋转的角度数)\n            ctx.lineTo(Math.cos((i * 1) / 180 * Math.PI) * (r + value) + centerX, (- Math.sin((i * 1) / 180 * Math.PI) * (r + value) + centerY));\n            \n        }\n        ctx.stroke();\n\n        //画一个小圆，将线条覆盖\n        // ctx.beginPath();\n        // ctx.lineWidth = 1;\n        // ctx.arc(centerX, centerY, r, 0, 2 * Math.PI, false);\n        // ctx.fillStyle = \"#fff\";\n        // ctx.stroke();\n        // ctx.fill();\n    }\n}"],"names":["SirWave","opt","x","Math","pow","K","attenuation","color","width","ctx","moveTo","beginPath","strokeStyle","lineWidth","y","i","height","noise","_globalAttenuationFn","sin","F","phase","lineTo","stroke","globalCompositeOperation","fillRect","run","speed","PI","_clear","lines","forEach","line","_drawLine","apply","requestAnimationFrame","_draw","bind","v","min","MAX","setNoise","setSpeed","devicePixelRatio","canvas","document","createElement","style","container","body","appendChild","getContext","auduoMap","params","el","Error","Object","assign","initlize","url","SW","start","audio","paused","play","pause","audioCtx","window","AudioContext","webkitAudioContext","Audio","crossOrigin","source","createMediaElementSource","analyser","createAnalyser","connect","destination","bufferLength","output","clearRect","barWidth","barHeight","fillStyle","r","centerX","centerY","value","cos"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAqBA,UACjB,iBAAYC,GAAZ,EAAgB;EAAA;;EAAA;;EAAA,gDAmCK,UAACC,CAAD,EAAK;EAC5B,WAAOC,IAAI,CAACC,GAAL,CAAS,KAAI,CAACC,CAAL,GAAO,CAAP,IAAU,KAAI,CAACA,CAAL,GAAO,CAAP,GAASF,IAAI,CAACC,GAAL,CAASF,CAAT,EAAW,CAAX,CAAnB,CAAT,EAA2C,KAAI,CAACG,CAAL,GAAO,CAAlD,CAAP;EACA,GArCkB;;EAAA,qCAuCT,UAACC,WAAD,EAAcC,KAAd,EAAqBC,KAArB,EAA6B;EACtC,IAAA,KAAI,CAACC,GAAL,CAASC,MAAT,CAAgB,CAAhB,EAAkB,CAAlB;;EACA,IAAA,KAAI,CAACD,GAAL,CAASE,SAAT;;EACA,IAAA,KAAI,CAACF,GAAL,CAASG,WAAT,GAAuBL,KAAvB;EACA,IAAA,KAAI,CAACE,GAAL,CAASI,SAAT,GAAqBL,KAAK,IAAI,CAA9B;EACA,QAAIN,CAAJ,EAAOY,CAAP;;EACA,SAAK,IAAIC,CAAC,GAAC,CAAC,KAAI,CAACV,CAAjB,EAAoBU,CAAC,IAAE,KAAI,CAACV,CAA5B,EAA+BU,CAAC,IAAE,IAAlC,EAAwC;EACvCb,MAAAA,CAAC,GAAG,KAAI,CAACM,KAAL,IAAY,CAACO,CAAC,GAAC,KAAI,CAACV,CAAR,KAAY,KAAI,CAACA,CAAL,GAAO,CAAnB,CAAZ,CAAJ;EACAS,MAAAA,CAAC,GAAG,KAAI,CAACE,MAAL,GAAY,CAAZ,GAAgB,KAAI,CAACC,KAAL,GAAa,KAAI,CAACC,oBAAL,CAA0BH,CAA1B,CAAb,IAA6C,IAAET,WAA/C,IAA8DH,IAAI,CAACgB,GAAL,CAAS,KAAI,CAACC,CAAL,GAAOL,CAAP,GAAS,KAAI,CAACM,KAAvB,CAAlF;;EACA,MAAA,KAAI,CAACZ,GAAL,CAASa,MAAT,CAAgBpB,CAAhB,EAAmBY,CAAnB;EACA;;EACD,IAAA,KAAI,CAACL,GAAL,CAASc,MAAT;EACA,GAnDkB;;EAAA,kCAqDZ,YAAI;EACV,IAAA,KAAI,CAACd,GAAL,CAASe,wBAAT,GAAoC,iBAApC;;EACA,IAAA,KAAI,CAACf,GAAL,CAASgB,QAAT,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,KAAI,CAACjB,KAA7B,EAAoC,KAAI,CAACQ,MAAzC;;EACA,IAAA,KAAI,CAACP,GAAL,CAASe,wBAAT,GAAoC,aAApC;EACA,GAzDkB;;EAAA,iCA2Db,YAAI;EACT,QAAI,CAAC,KAAI,CAACE,GAAV,EAAe;EAEf,IAAA,KAAI,CAACL,KAAL,GAAa,CAAC,KAAI,CAACA,KAAL,GAAW,KAAI,CAACM,KAAjB,KAAyBxB,IAAI,CAACyB,EAAL,GAAQ,EAAjC,CAAb;;EACA,IAAA,KAAI,CAACC,MAAL;;EAEA,IAAA,KAAI,CAACC,KAAL,CAAWC,OAAX,CAAmB,UAACC,IAAD,EAAQ;EAC1B,MAAA,KAAI,CAACC,SAAL,CAAeC,KAAf,CAAqB,KAArB,EAA2BF,IAA3B;EACA,KAFD;;EAIAG,IAAAA,qBAAqB,CAAC,KAAI,CAACC,KAAL,CAAWC,IAAX,CAAgB,KAAhB,CAAD,EAAwB,IAAxB,CAArB;EACA,GAtEkB;;EAAA,iCAwEb,YAAI;EACT,IAAA,KAAI,CAAChB,KAAL,GAAa,CAAb;EACA,IAAA,KAAI,CAACK,GAAL,GAAW,IAAX;;EACA,IAAA,KAAI,CAACU,KAAL;EACA,GA5EkB;;EAAA,gCA8Ed,YAAI;EACR,IAAA,KAAI,CAACV,GAAL,GAAW,KAAX;;EACA,IAAA,KAAI,CAACG,MAAL;EACA,GAjFkB;;EAAA,iCAmFb,YAAI;EACT,IAAA,KAAI,CAACH,GAAL,GAAW,KAAX;EACA,GArFkB;;EAAA,oCAuFV,UAACY,CAAD,EAAK;EACb,IAAA,KAAI,CAACrB,KAAL,GAAad,IAAI,CAACoC,GAAL,CAASD,CAAT,EAAY,CAAZ,IAAe,KAAI,CAACE,GAAjC;EACA,GAzFkB;;EAAA,oCA2FV,UAACF,CAAD,EAAK;EACb,IAAA,KAAI,CAACX,KAAL,GAAaW,CAAb;EACA,GA7FkB;;EAAA,+BA+Ff,UAACrB,KAAD,EAAQU,KAAR,EAAgB;EACnB,IAAA,KAAI,CAACc,QAAL,CAAcxB,KAAd;;EACA,IAAA,KAAI,CAACyB,QAAL,CAAcf,KAAd;EACA,GAlGkB;;EACZ,OAAK1B,GAAL,GAAWA,GAAG,IAAI,EAAlB;EAEA,OAAKI,CAAL,GAAS,CAAT;EACA,OAAKe,CAAL,GAAS,CAAT;EACA,OAAKO,KAAL,GAAa,KAAK1B,GAAL,CAAS0B,KAAT,IAAkB,GAA/B;EACA,OAAKV,KAAL,GAAa,KAAKhB,GAAL,CAASgB,KAAT,IAAkB,CAA/B;EACA,OAAKI,KAAL,GAAa,KAAKpB,GAAL,CAASoB,KAAT,IAAkB,CAA/B;EACA,OAAKS,KAAL,GAAa,KAAK7B,GAAL,CAAS6B,KAAT,IAAkB,CACpC,CAAC,CAAC,CAAF,EAAK,wBAAL,CADoC,EAEpC,CAAC,CAAC,CAAF,EAAK,uBAAL,CAFoC,EAGpC,CAAC,CAAD,EAAI,uBAAJ,CAHoC,EAIpC,CAAC,CAAD,EAAI,uBAAJ,CAJoC,EAKpC,CAAC,CAAD,EAAI,qBAAJ,EAA2B,GAA3B,CALoC,CAA/B;EAQA,MAAI,CAACa,gBAAL,EAAuBA,gBAAgB,GAAG,CAAnB;EACvB,OAAKnC,KAAL,GAAamC,gBAAgB,IAAI,KAAK1C,GAAL,CAASO,KAAT,IAAkB,GAAtB,CAA7B;EACA,OAAKQ,MAAL,GAAc2B,gBAAgB,IAAI,KAAK1C,GAAL,CAASe,MAAT,IAAmB,GAAvB,CAA9B;EACA,OAAKwB,GAAL,GAAY,KAAKxB,MAAL,GAAY,CAAb,GAAgB,CAA3B;;EAEN,MAAG,KAAKf,GAAL,CAASQ,GAAZ,EAAgB;EACf,SAAKA,GAAL,GAAW,KAAKR,GAAL,CAASQ,GAApB;EACA,GAFD,MAEK;EACJ,SAAKmC,MAAL,GAAcC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd;EACA,SAAKF,MAAL,CAAYpC,KAAZ,GAAoB,KAAKA,KAAzB;EACA,SAAKoC,MAAL,CAAY5B,MAAZ,GAAqB,KAAKA,MAA1B;EACA,SAAK4B,MAAL,CAAYG,KAAZ,CAAkBvC,KAAlB,GAA2B,KAAKA,KAAL,GAAWmC,gBAAZ,GAA8B,IAAxD;EACA,SAAKC,MAAL,CAAYG,KAAZ,CAAkB/B,MAAlB,GAA4B,KAAKA,MAAL,GAAY2B,gBAAb,GAA+B,IAA1D;EACA,KAAC,KAAK1C,GAAL,CAAS+C,SAAT,IAAsBH,QAAQ,CAACI,IAAhC,EAAsCC,WAAtC,CAAkD,KAAKN,MAAvD;EACA,SAAKnC,GAAL,GAAW,KAAKmC,MAAL,CAAYO,UAAZ,CAAuB,IAAvB,CAAX;EACA;;EACK,OAAKzB,GAAL,GAAW,KAAX;EACH;;MC1BgB0B;;;EACjB,oBAAYC,MAAZ,EAAmB;EAAA;;EACf,QAAG,CAACA,MAAM,CAACC,EAAX,EAAc;EACV,YAAMC,KAAK,CAAC,iBAAD,CAAX;EACH;;EAEDC,IAAAA,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoBJ,MAApB;EAEA,SAAKK,QAAL,CAAc,KAAKC,GAAnB;EAEA,SAAKC,EAAL,GAAU,IAAI5D,OAAJ,CAAY;EAClBS,MAAAA,GAAG,EAAE,KAAKA,GADQ;EAElBD,MAAAA,KAAK,EAAE,KAAKA,KAFM;EAGlBQ,MAAAA,MAAM,EAAE,KAAKA,MAHK;EAIlBc,MAAAA,KAAK,EAAC,KAAKA;EAJO,KAAZ,CAAV;EAMA,SAAK8B,EAAL,CAAQlB,QAAR,CAAiB,GAAjB;EACA,SAAKkB,EAAL,CAAQC,KAAR;EACA,SAAKD,EAAL,CAAQnB,QAAR,CAAiB,GAAjB;EACH;;;;6BAEK;EACF,UAAG,KAAKqB,KAAL,CAAWC,MAAd,EAAqB;EACjB,aAAKD,KAAL,CAAWE,IAAX;EACH,OAFD,MAEK;EACD,aAAKF,KAAL,CAAWG,KAAX;EACH;EAEJ;;;gCACQ;EACL,WAAKH,KAAL,CAAWG,KAAX;EACH;;;;+BAGQN,KAAI;EACT,UAAIf,MAAM,GAAG,KAAKU,EAAlB;EACA,WAAK7C,GAAL,GAAW,KAAKA,GAAL,GAAWmC,MAAM,CAACO,UAAP,CAAkB,IAAlB,CAAtB;EAEA,UAAIe,QAAQ,GAAG,KAAKC,MAAM,CAACC,YAAP,IAAuBD,MAAM,CAACE,kBAAnC,GAAf;EACA,UAAIP,KAAK,GAAG,KAAKA,KAAL,GAAa,IAAIQ,KAAJ,CAAUX,GAAV,CAAzB;EACAG,MAAAA,KAAK,CAACS,WAAN,GAAoB,WAApB;EAEA,WAAKC,MAAL,GAAcN,QAAQ,CAACO,wBAAT,CAAkCX,KAAlC,CAAd;EACA,WAAKY,QAAL,GAAgBR,QAAQ,CAACS,cAAT,EAAhB,CATS;;EAYT,WAAKH,MAAL,CAAYI,OAAZ,CAAoB,KAAKF,QAAzB;EACA,WAAKA,QAAL,CAAcE,OAAd,CAAsBV,QAAQ,CAACW,WAA/B;EACA,WAAKC,YAAL,GAAoB,GAApB;EAEH;;;gCAEQ;;;iCAIErE,KAAKsE,QAAO;EACnBtE,MAAAA,GAAG,CAACuE,SAAJ,CAAc,CAAd,EAAiB,CAAjB,EAAoB,KAAKxE,KAAzB,EAAgC,KAAKQ,MAArC;EACAP,MAAAA,GAAG,CAACI,SAAJ,GAAgB,CAAhB;EACAJ,MAAAA,GAAG,CAACE,SAAJ;EAEA,UAAImE,YAAY,GAAG,KAAKA,YAAxB;EACA,UAAIG,QAAQ,GAAI,KAAKzE,KAAL,GAAasE,YAAd,GAA8B,GAA7C;EACA,UAAII,SAAJ;EACA,UAAIhF,CAAC,GAAG,CAAR;;EAEA,WAAI,IAAIa,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG+D,YAAnB,EAAiC/D,CAAC,EAAlC,EAAsC;EAClCmE,QAAAA,SAAS,GAAGH,MAAM,CAAChE,CAAD,CAAN,GAAU,CAAtB;EAEAN,QAAAA,GAAG,CAAC0E,SAAJ,GAAgB,MAAhB;EACA1E,QAAAA,GAAG,CAACgB,QAAJ,CAAavB,CAAb,EAAe,KAAKc,MAAL,GAAYkE,SAAS,GAAC,CAArC,EAAuCD,QAAvC,EAAgDC,SAAhD;EAEAhF,QAAAA,CAAC,IAAI+E,QAAQ,GAAG,CAAhB;EACH;EAEJ;;;iCAEUxE,KAAKsE,QAAe;EAAA,UAANK,CAAM,uEAAJ,GAAI;EAC3B3E,MAAAA,GAAG,CAACuE,SAAJ,CAAc,CAAd,EAAiB,CAAjB,EAAoB,KAAKxE,KAAzB,EAAgC,KAAKQ,MAArC,EAD2B;;EAG3B,UAAIqE,OAAO,GAAG,KAAK7E,KAAL,GAAW,CAAzB;EACA,UAAI8E,OAAO,GAAG,KAAKtE,MAAL,GAAY,CAA1B;EAEAP,MAAAA,GAAG,CAACE,SAAJ;EACAF,MAAAA,GAAG,CAACI,SAAJ,GAAgB,CAAhB;EAEAJ,MAAAA,GAAG,CAACC,MAAJ,CAAW2E,OAAX,EAAoBC,OAApB;;EAEA,WAAK,IAAIvE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAE,GAAnB,EAAyBA,CAAC,EAA1B,EAA8B;EAC1B,YAAIwE,KAAK,GAAGR,MAAM,CAAChE,CAAD,CAAlB,CAD0B;EAE1B;;EACAN,QAAAA,GAAG,CAACa,MAAJ,CAAWnB,IAAI,CAACqF,GAAL,CAAUzE,CAAC,GAAG,CAAL,GAAU,GAAV,GAAgBZ,IAAI,CAACyB,EAA9B,KAAqCwD,CAAC,GAAGG,KAAzC,IAAkDF,OAA7D,EAAuE,CAAElF,IAAI,CAACgB,GAAL,CAAUJ,CAAC,GAAG,CAAL,GAAU,GAAV,GAAgBZ,IAAI,CAACyB,EAA9B,CAAF,IAAuCwD,CAAC,GAAGG,KAA3C,IAAoDD,OAA3H;EAEH;;EACD7E,MAAAA,GAAG,CAACc,MAAJ,GAjB2B;EAoB3B;EACA;EACA;EACA;EACA;EACA;EACH;;;;;;;;;;;;"}